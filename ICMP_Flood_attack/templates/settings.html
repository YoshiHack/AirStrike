{% extends 'base.html' %}

{% block title %}ICMP Flood - Settings{% endblock %}

{% block content %}
<h1>Settings</h1>

<div class="card">
    <div class="card-header">Interface Settings</div>
    <div class="card-body">
        <div class="form-group">
            <label for="interface">Wireless Interface:</label>
            <select id="interface" class="form-control">
                <!-- Interface options will be inserted here -->
            </select>
        </div>
        <button id="save-interface-btn" class="btn btn-primary">Save Interface</button>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">System Information</div>
    <div class="card-body">
        <div id="system-info">
            <p><strong>Checking system information...</strong></p>
        </div>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">About</div>
    <div class="card-body">
        <h3>ICMP Flood Attack Framework</h3>
        <p>This application is designed for educational purposes and authorized penetration testing only.</p>
        <p><strong>Warning:</strong> Unauthorized use against networks you do not own or have permission to test is illegal and unethical.</p>
        <p>Based on the AirStrike framework design with a focus on ICMP flood attacks.</p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Page elements
    const interfaceSelect = document.getElementById('interface');
    const saveInterfaceBtn = document.getElementById('save-interface-btn');
    const systemInfo = document.getElementById('system-info');
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        // Get interfaces
        getInterfaces();
        
        // Get system info
        getSystemInfo();
        
        // Button handlers
        saveInterfaceBtn.addEventListener('click', saveInterface);
    });
    
    // Get available network interfaces
    function getInterfaces() {
        // Make API request to get interfaces (placeholder)
        // In a real implementation, you would have an endpoint to get interfaces
        
        // For now, just add some placeholder interfaces
        const interfaces = ['wlan0', 'eth0', 'wlan1'];
        
        // Build options
        let html = '';
        interfaces.forEach(iface => {
            html += `<option value="${iface}">${iface}</option>`;
        });
        
        // Update select
        interfaceSelect.innerHTML = html;
    }
    
    // Get system information
    function getSystemInfo() {
        // Check sudo privileges
        fetch('/api/check-privileges')
            .then(response => response.json())
            .then(data => {
                let html = `
                    <p><strong>Root Privileges:</strong> ${data.has_sudo ? 'Yes ✅' : 'No ❌'}</p>
                `;
                
                if (!data.has_sudo) {
                    html += `
                        <div class="alert alert-danger">
                            <p><strong>Warning:</strong> This application requires root privileges to function properly.</p>
                            <p>Please restart the application with sudo:</p>
                            <pre>sudo python app.py</pre>
                        </div>
                    `;
                }
                
                html += `
                    <p><strong>Current Time:</strong> ${new Date().toLocaleString()}</p>
                    <p><strong>Browser:</strong> ${navigator.userAgent}</p>
                `;
                
                systemInfo.innerHTML = html;
            })
            .catch(error => {
                console.error('Error checking privileges:', error);
                systemInfo.innerHTML = '<p class="text-danger">Error checking system information.</p>';
            });
    }
    
    // Save interface setting
    function saveInterface() {
        const selectedInterface = interfaceSelect.value;
        
        // In a real implementation, you would have an endpoint to save settings
        alert(`Interface ${selectedInterface} selected. (This is a placeholder - settings aren't actually saved)`);
    }
</script>
{% endblock %}
